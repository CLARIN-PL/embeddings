{{ $type := default "Tasks" (.Get "type") }}
{{ $fields := slice "submission_name" "dataset_name" "embedding_name" }}
{{ $leaderboard := slice "leaderboard_task_name"}}
{{ $fieldsValue := slice  "embedding_name" }}
{{ $metrics := slice }}
{{ $metricsToIgnore := slice "classes" }}
{{ range $.Site.Data.results }}
   {{ range $k, $v := .metrics_avg }}
      {{if (not (in $metricsToIgnore $k)) }}
         {{ $metrics = uniq ($metrics | append $k) }}
      {{end}}
   {{ end }}
{{ end }}
{{ $fields :=  $fields | uniq }}

<style scoped>
      .title {
        font-size: 32px;
        font-weight: 300;
        margin: 0.5em 0 1.5em 0;
        
      }
      .title-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #6e6e6e;
        max-width: 90% !important;
      }
</style>
<div>
   <div class="container title-container">     
      <div class="title">{{ $type }}</div>
   </div>

   <table id="data-table">
   <thead>
      <tr>
         <th>
            Details
         </th>
         {{ range $field := $fields }}
         <th>
            {{ $field  | humanize  }}
         </th>
         {{ end }}
         {{ range $metric := $metrics }}
            <th>
               {{ $metric  |  humanize  }}
            </th>
         {{ end }}
         </tr>
   </thead>
<div>
   
</div>
   {{ range $file, $result := $.Site.Data.results }}
   {{if or (eq $type "Tasks") (eq (index $result $leaderboard) $type)}}
   <div>
      <tr>
         <td>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#{{$file}}">
               Details
            </button>
         </td>
         {{ range $field:= $fields }}
         <td>
            {{if (in $fieldsValue $field)}}
               {{ index $result $field "value"}}
            {{else}}
               {{ index $result $field }}
            {{end}}
         </td>
         {{ end }}
         {{ range $metric:= $metrics }}
         <td>
               {{(index $result "metrics_avg"  $metric) }}
            </td>
         {{ end }}
         </tr>
   {{end}} 
   {{end}}
   </table>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.9.3/js/tabulator.min.js" integrity="sha512-N/WbW5rCM/O+/QpzuqYXkInRdSfFu6txbJcbQioBywGXDiF1XCJY2LXVKIGjNFUMS4P79mtf9pDu5ViXaa+BnA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.9.3/css/bootstrap/tabulator_bootstrap4.min.css" integrity="sha512-pXZ8FsuOBAyDmJ3OWob4V2UgZWQ8zs8f99MrNv0sBG8VLzuucajpzJ3BIiVNzTpfIYgzWGUq0QPJ3Y/9Gr4h7Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />

   <script>
      var table = new Tabulator("#data-table", {
         layout:"fitData",
         movableColumns: true
      });
      var formattedColumns = table.getColumnDefinitions().map(c => { c.formatter = "html"; return c})
      formattedColumns.slice(1).forEach(c => c.headerFilter = true)
      table.setColumns(formattedColumns)
   </script>


</div>

{{ range $file, $result := $.Site.Data.results }}
<div class="modal modal-xl fade" id="{{$file}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">{{$file | humanize}}</h5>
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
               <span aria-hidden="true">&times;</span>
            </button>
         </div>
         <div class="modal-body">
                  {{ range $k, $v := $result}}
                  <p>
                     <strong>{{$k}}</strong>
               <pre>{{jsonify (dict "indent" " ") $v}}</pre>
                  </p>
                  {{end}}
         </div>
      </div>
   </div>
</div>
{{end}}
</div>
