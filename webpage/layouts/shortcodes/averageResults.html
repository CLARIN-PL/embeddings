{{ $tasktype := default "Tasks" (.Get "tasktype") }}
{{ $modelsTemp := slice }}
{{ range $file, $result := $.Site.Data.results }}  
    {{ $modelsTemp = uniq ($modelsTemp | append (index $result "embedding_name")) }}
{{end}}
{{ $models := slice }}
{{ range $model := $modelsTemp }}  
{{ $models = uniq ($models | append (index $model "value")) }}
{{end}}

{{ $metrics := slice }}
{{ $metricsToIgnore := slice "classes" "f1_weighted" "recall_weighted" "precision_weighted" }}
{{ range $.Site.Data.results }}
   {{ range $k, $v := .metrics_avg }}
      {{if (not (in $metricsToIgnore $k)) }}
         {{ $metrics = uniq ($metrics | append $k) }}
      {{end}}
   {{ end }}
{{ end }}

<style scoped>
    .title {
      font-size: 32px;
      font-weight: 300;
      margin: 0.5em 0;
      text-align: center;
    }
</style>
<div style="margin: 0 2em;">
    <div class="container title-container">     
       <div class="title">{{ $tasktype }}</div>
</div>

<table id="data-table" >
    <thead>
        <tr>
            <th>
                Dataset
            </th>
            {{ range $metric := $metrics }}
                <th>
                    {{ $metric  |  humanize  }}
                </th>
            {{end}}
       </tr>
    </thead>
 {{ range $file, $result := $.Site.Data.results }}
    <tr>
        <td>
            {{index $result "dataset_name" }}
        </td>
        {{ range $metric:= $metrics }}
            <td>
                {{(index $result "metrics_avg"  $metric) }}
            </td>
        {{ end }}
    </tr>
 {{end}}
 </table>

 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.9.3/js/tabulator.min.js" integrity="sha512-N/WbW5rCM/O+/QpzuqYXkInRdSfFu6txbJcbQioBywGXDiF1XCJY2LXVKIGjNFUMS4P79mtf9pDu5ViXaa+BnA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.9.3/css/bootstrap/tabulator_bootstrap4.min.css" integrity="sha512-pXZ8FsuOBAyDmJ3OWob4V2UgZWQ8zs8f99MrNv0sBG8VLzuucajpzJ3BIiVNzTpfIYgzWGUq0QPJ3Y/9Gr4h7Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />

 <script>
    let table = new Tabulator("#data-table", {
        layout:"fitColumns",
        movableColumns: true
    });
         
    let formattedColumns = table.getColumnDefinitions().map(c => { c.formatter = "html"; return c})       
    formattedColumns.forEach((col,i) => {
        if(i==0){
            col.widthGrow = 3;
            col.headerFilter = true;
        }else{
            col.formatter = "money";
            col.hozAlign = "center";
            col.formatterParams = {
                precision:3,
            };
            col.headerFilter = false;
        }
    })
    table.setColumns(formattedColumns)
 </script>